# これなに
スプシからクイズだすやつ

## これから考慮が必要な内容
- CSSの精査
- X以外のサイトへの共有ボタン（未定
- 超級試験結果のSNS共有ボタン（未定
  
## デモサイト

https://nomynoma.github.io/gas-kentei-quiz/

## 問題集のスプシ
https://docs.google.com/spreadsheets/d/1Xycd1Wtq0ZNiQyhEIscRKndbyEeYt0H26wih9OXDJr8/edit?usp=sharing

## 概要

### 🎯 基本の流れ
1. ニックネーム入力
- 初回アクセス時にニックネームを入力（最大10文字）
- 合格証に表示される名前になります
- 右上の🖊️ボタンでいつでも変更可能
2. ジャンル選択
- 6つのジャンルから挑戦したいジャンルを選択
- 各ジャンルには4つの難易度があります
3. 難易度選択
- 初級 🥉：いつでも挑戦可能
- 中級 🥈：初級クリア後に解放
- 上級 🥇：中級クリア後に解放
- 超級 🏆：上級クリア後に解放（特別モード）
4. 問題に挑戦
- 初級・中級・上級：選択ジャンル・レベルに該当する問題すべてから10問選出し出題、全問解答後に採点
- 超級：選択ジャンル・全レベルの問題すべてをランダムな順番で、1問10秒の制限時間、即座判定
5. 合格証をゲット
- 合格するとその場で合格証を発行
- 難易度クリア済みは🥉🥈🥇🏆のアイコンで表示
- アイコンをクリックで合格証を再表示

#### ⚡ 超級モードの特徴
- 問題数: 初級・中級・上級の全問題
- 制限時間: 1問につき10秒
- 即座判定: 正解で次の問題へ自動遷移、不正解または時間切れで即終了
- 高難易度: 全問正解で初めて合格証を獲得

#### 🌟 エクストラステージ（隠しステージ）
- 解放条件: 全ジャンルの上級をクリア
- 問題数: 全ジャンル×全レベルの問題
- ルール: 超級モードと同じ（1問10秒、即座判定）
- ランキング機能:
  - 👑 全問正解者（殿堂入り）: 100点達成者を達成順に表示
  - 🔥 挑戦者スコアTOP10: 100点未満のハイスコア上位10名
- スコア登録: 常時スコアを登録可能

#### 💾 データの保存
**localStorage（ブラウザローカルストレージ）**
- ブラウザを変えたり、キャッシュをクリアすると消えます
- 保存内容:
  - 合格証画像: Base64エンコードされたWebP画像データ
    - 保存キー形式: `{ジャンル番号}-{難易度番号}` (例: "1-1", "1-4", "ALL")
    - 画像サイズ: 800x565px
    - WebP品質: 0.8（圧縮率20%）
  - ニックネーム: ユーザーが入力した表示名（最大10文字）
  - ブラウザID: UUID v4形式で自動生成される一意識別子（ランキング登録用）

**Google スプレッドシート（サーバー側データベース）**
- 永続的に保存されます
- 保存内容:
  - 問題データ: 各ジャンル・難易度ごとの問題、選択肢、正解、ヒント
  - ランキングデータ（エクストラステージのみ）:
    - browserId: ブラウザ識別用UUID
    - nickname: ユーザーのニックネーム
    - score: 正解問題数
    - timestamp: 登録日時
    - genre: 固定値「エクストラステージ」
    - isPerfect: 全問正解フラグ（true/false）

#### 🎮 その他の機能
- 再挑戦: クリア済みの難易度も何度でも挑戦可能（合格証画像は上書き、スコアも上書き）
- ジャンル選択へ戻る: 画面左上のボタンでいつでも戻れる
- 合格証ダウンロード: 合格証画面から画像をダウンロード可能
- 合格証の再表示: アイコンクリックでポップアップ表示
- SNS共有: 𝕏（旧Twitter）で結果をシェア可能
- ランキング確認: エクストラステージのランキングをいつでも閲覧可能


---
以下自動出力

## 主な機能

### 基本機能
- **6つのジャンル**: ジャンル1〜6から選択可能
- **4段階の難易度**: 初級 → 中級 → 上級 → 超級の順に挑戦
- **ニックネーム機能**: 最初にニックネームを入力し、合格証明書に表示
  - 右上の🖊️ボタンでいつでも変更可能
- **段階的解放システム**: 前の難易度をクリアすると次の難易度が解放
- **合格証明書の永続保存**: localStorage に保存され、いつでも確認可能
- **アイコン表示**: クリア済み難易度を🥉🥈🥇🏆のアイコンで表示

### 通常モード（初級・中級・上級）
- **ランダム出題**: 各レベルから10問をランダムに抽出
- **選択肢シャッフル**: 問題ごとに選択肢の順序をランダム化
- **全問解答後に採点**: 10問すべて解答してから正誤判定
- **合格制**: 10問全問正解で次のレベルへ進める
- **間違えた問題の確認**: 不合格時は間違えた問題とヒントを表示
- **合格証明書**: クリア時にニックネーム・日付入りの証明書を発行

### 超級モード（特別モード）
上級クリア後に解放される高難易度チャレンジモード：
- **問題数**: 初級・中級・上級の全問題がランダムに出題（約30問）
- **制限時間**: 1問につき10秒
- **即座判定**: 解答するとその場で正誤判定
  - 正解 → 次の問題へ自動遷移
  - 不正解または時間切れ → 即座にゲームオーバー
- **ハッシュ値による正解管理**: 正解を隠蔽し、クライアント側でハッシュ比較
- **全問正解で合格**: 1問でも間違えると不合格

### エクストラステージ
全ジャンルの上級をクリアすると解放される最終チャレンジ：
- **全ジャンル・全レベルの問題**: 6ジャンル×3レベル（初級・中級・上級）の全問題から出題
- **超級モードと同じルール**: 1問10秒、即座判定、不正解で終了
- **スコアランキング機能**:
  - 👑 **全問正解者（殿堂入り）**: 全問正解達成者を達成順に表示
  - 🔥 **挑戦者スコアTOP10**: 全問正解未満のハイスコア上位10名
- **ブラウザ識別**: UUID v4による識別で同一ブラウザからの重複登録を防止
- **スコア更新**: より高いスコアを取ると自動で上書き

### 問題形式
**出題形式**
- 選択問題
  - **単一選択（single）**: 1つの正解を選ぶ問題
  - **複数選択（multiple）**: 複数の正解をすべて選ぶ問題
    - 通常モード: チェックボックスで複数選択可能
    - 超級・エクストラ: ボタンのトグル選択 + 「回答する」ボタン
- 入力問題
  - **入力問題（input）**: テキスト入力で解答する問題
    - 通常モード: テキストフィールド
    - 超級・エクストラ: テキストフィールド + Enterキー対応

**表示形式**
- **テキスト表示（text）**: 文字での選択肢表示（HTMLサニタイズ済み）
- **画像表示（image）**: 画像URLを選択肢として表示

### UI/UX機能
- **レスポンシブデザイン**: モバイル・タブレット・PC対応
- **直感的な操作**:
  - 通常モード: 問題間を自由に行き来できるスライダー風ナビゲーション
  - 回答状況インジケーター: 解答済み・未解答を色で表示
- **合格証モーダル**: アイコンクリックで過去の合格証をポップアップ表示
- **ローディング表示**: 問題読み込み中の待機画面

### データ管理
**localStorage（ブラウザローカル）**
- ニックネーム（最大10文字）
- 合格証明書（Base64エンコードされたWebP画像データ）
  - 保存キー形式: `{ジャンル番号}-{難易度番号}` (例: "1-1", "1-4", "ALL")
  - 画像サイズ: 800x565px、WebP品質0.8
- ブラウザID（UUID v4形式）

**Google スプレッドシート（サーバー側）**
- 問題データ（CacheService によるキャッシュ機能付き）
- エクストラステージのスコアランキング
  - browserId（UUID）, nickname, score（正解問題数）, timestamp, genre, isPerfect（全問正解フラグ）

### ソーシャル機能
- **X（Twitter）共有ボタン**:
  - 合格時: ジャンル名・レベル・達成内容を投稿
  - 不合格時: ジャンル名・レベル・スコアを投稿
  - エクストラステージ: スコアとランキング結果を投稿
- **OGP対応**: シェア時に専用画像とタイトルを表示

### セキュリティ機能
- **DOMPurify**: XSS対策のためユーザー入力・問題テキストをサニタイズ
- **SHA-256ハッシュ**: 超級・エクストラの正解をハッシュ化して隠蔽
- **レート制限**: GAS側で短時間の大量リクエストを制限
- **入力検証**: ニックネーム長・文字種の制限

## 合格証明書

各難易度クリア時に発行される合格証明書：

| 難易度 | 画像ファイル名 | 表示内容 | 備考 |
|-------|--------------|---------|------|
| 初級合格 🥉 | `frame_hyousyoujyou_{ジャンル番号}-1.jpg` | ニックネーム＋殿<br>日付 | |
| 中級合格 🥈 | `frame_hyousyoujyou_{ジャンル番号}-2.jpg` | ニックネーム＋殿<br>日付 | |
| 上級合格 🥇 | `frame_hyousyoujyou_{ジャンル番号}-3.jpg` | ニックネーム＋殿<br>日付 | |
| 超級合格 🏆 | `frame_hyousyoujyou_{ジャンル番号}-4.jpg` | ニックネーム＋殿<br>日付 | 現在は上級画像を流用 |
| エクストラ 🌟 | `frame_hyousyoujyou_ALL.jpg` | ニックネーム＋殿<br>日付 | 現在は仮画像 |

**合格証明書の仕組み**
- **html2canvas**: DOMを画像化してBase64形式で保存
- **オフスクリーンレンダリング**: 固定サイズ（800x565px）のキャプチャ用要素を画面外に配置
- **背景画像 + テキストオーバーレイ**: CERTIFICATE_BG_IMAGE_MAPから背景取得、テキストを重ねて描画
- **ダウンロード機能**: WebP形式で保存可能
- **再表示機能**: アイコンクリックでlocalStorageから読み込み

## 技術スタック

### フロントエンド
- HTML5 / CSS3 / JavaScript (ES6+)
- html2canvas (合格証生成)
- DOMPurify (XSS対策)
- Web Crypto API (SHA-256ハッシュ)

### バックエンド
- Google Apps Script (GAS)
- Google スプレッドシート (データベース)
- CacheService (問題データキャッシュ)

### ホスティング
- GitHub Pages (静的ファイル)
- Google Apps Script Web App (API)

## 設定ファイル

`config.js` ですべてのURL・ジャンル設定を一元管理：

```javascript
// ホスティングベースURL
const HOSTING_BASE_URL = 'https://nomynoma.github.io/gas-kentei-quiz';

// GAS デプロイURL
const GAS_DEPLOYMENT_URL = 'https://script.google.com/macros/s/.../exec';

// ジャンル名配列（スプレッドシートのシート名と一致させる）
const GENRE_NAMES = ['ジャンル1', 'ジャンル2', ...];

// 合格証背景画像マッピング
const CERTIFICATE_BG_IMAGE_MAP = {
  '1-1': HOSTING_BASE_URL + '/imgs/frame_hyousyoujyou_1-1.jpg',
  ...
};
```

## スプレッドシート構造

**問題シート（各ジャンル × 各難易度）**
| 列 | 内容 | 備考 |
|----|------|------|
| A | 問題ID | 一意の識別子 |
| B | レベル | 初級/中級/上級 |
| C | 選択方式 | single/multiple/input |
| D | 表示形式 | text/image |
| E | 問題文 | HTML可 |
| F | 選択肢A | |
| G | 選択肢B | |
| H | 選択肢C | |
| I | 選択肢D | |
| J | 正解 | A,B形式 or テキスト |
| K | ヒントURL | 不正解時表示 |

**スコアランキングシート**
| 列 | 内容 |
|----|------|
| A | browserId (UUID) |
| B | nickname |
| C | score (0-100) |
| D | timestamp |
| E | genre (固定: "エクストラステージ") |
| F | isPerfect (true/false) |

## ライセンス
このプロジェクトは個人の趣味の範囲で作成されています。
