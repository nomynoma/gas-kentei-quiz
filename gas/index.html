<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<base target="_top">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>クイズアプリ</title>
<link rel="icon" href="https://nomynoma.github.io/gas-kentei-quiz/imgs/favicon.svg" type="image/svg+xml">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<!-- 外部CSSファイル読み込み（GitHub Pages） -->
<link rel="stylesheet" href="https://nomynoma.github.io/gas-kentei-quiz/style.css">
<!-- DOMPurify CDN を head に追加しておく -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<div class="container">

  <!-- ニックネーム入力画面 -->
  <div id="nicknameScreen" class="screen active">
    <div id="nicknameForm">
      <h1>📝 ニックネーム入力</h1>
      <p class="description-text">
        合格証明書に表示するニックネームを入力してください
      </p>
      <!-- 編集モード時の警告メッセージ -->
      <div id="nicknameWarning" class="nickname-warning hidden">
        ⚠️ 名前を変更すると合格証がリセットされます！
      </div>
      <input type="text" id="nicknameInput" maxlength="10" placeholder="ニックネームを入力" class="text-input">
      <div id="nicknameError" class="error-text"></div>
      <button class="btn" onclick="submitNickname()">次へ</button>
    </div>
    <div id="preparingMessage" class="hidden">
      <h1>⏳ 問題作成中...</h1>
      <p class="description-text-top">
        しばらくお待ちください
      </p>
    </div>
  </div>

  <!-- ジャンル選択画面 -->
  <div id="genreScreen" class="screen">
    <!-- ニックネーム表示エリア（右上） -->
    <div id="nicknameDisplay" class="nickname-display">
      <span id="nicknameText">回答者：</span>
      <button id="editNicknameBtn" class="edit-nickname-btn" onclick="editNickname()" title="編集">🖊️</button>
    </div>

    <h1>📚 ジャンル選択</h1>
    <p class="description-text">
      挑戦したいジャンルを選んでください
    </p>
    <!-- ジャンルボタンはconfig.jsのGENRE_NAMESから動的に生成 -->
    <div id="genreButtons"></div>
  </div>

  <!-- 問題画面 -->
  <div id="questionScreen" class="screen">
    <!-- 【追加】回答状況インジケーター -->
    <div id="progressIndicator"></div>
    
    <!-- 【追加】上部ナビゲーション（前へ・次へボタン） -->
    <div id="topNavigation"></div>
    
    <!-- 問題番号（レベル名を含む形式に変更） -->
    <div id="questionNumber" class="question-number"></div>
    
    <!-- 複数選択の注意書き -->
    <div id="multipleInstruction" class="multiple-instruction" style="display:none;">
      ⚠️ 複数選択問題です。該当する選択肢をすべて選んでください。
    </div>
    
    <!-- 問題文 -->
    <div id="questionText" class="question-text"></div>
    
    <!-- 選択肢 -->
    <div id="choices"></div>
    
    <!-- 【削除】feedback は不要になりました -->
    <!-- <div id="feedback"></div> -->
    
    <!-- 【変更】下部ナビゲーションエリア（前へ・次へ・採点ボタン） -->
    <div id="navigation"></div>
  </div>

  <!-- 不合格画面 -->
  <div id="failScreen" class="screen">
    <h1>😢 不合格</h1>
    <div class="score-text" id="failResultText"></div>
    <p class="description-text-vertical">10問全問正解で次のレベルへ進めます</p>
    <button class="btn btn-twitter" onclick="shareFailToX()">𝕏 で共有する</button>
    <button class="btn" onclick="retryLevel()">もう一度挑戦する</button>
    <button class="btn btn-gray" onclick="restartQuiz()">最初から解く</button>
  </div>

  <!-- 合格証明書画面 -->
  <div id="certificateScreen" class="screen">
    <!-- 合格証明書エリア（生成した画像を表示・クリックで別窓） -->
    <div id="certificateArea" class="certificate-area">
      <a id="certificateLink" href="" target="_blank">
        <img id="certificateDisplayImage" 
            src="" 
            alt="合格証明書" 
            class="certificate-display-image"
            title="クリックで別窓表示">
      </a>
    </div>
    <!-- ボタンエリア -->
    <div class="button-area">
      <button class="btn btn-green" onclick="downloadCertificate()">合格証をダウンロード</button>
      <button class="btn btn-twitter" onclick="shareToX()">𝕏 で共有する</button>
      <button class="btn" id="certificateNextBtn" onclick="nextSection()">次のレベルへ</button>
      <button class="btn" id="certificateRestartBtn" onclick="restartQuiz()">最初からときなおす</button>
    </div>
  </div>

  <!-- ローディング画面 -->
  <div id="loading" class="screen">
    <div class="loading">問題を読み込んでいます...</div>
  </div>

</div>

<!-- ========================================
     キャプチャ用固定サイズ合格証エリア
     ========================================
     デバッグモード: 下記の1行目のコメントアウトを外すと画面に表示されます
     本番モード: 下記の2行目のコメントアウトを外すと画面外に配置されます
     ======================================== -->
<!-- デバッグモード: コメントアウトを外して有効化
<div id="captureArea" class="capture-area-debug">
  <div class="debug-label">DEBUG: キャプチャ元DOM (800x565)</div>
-->
<!-- 本番モード: デバッグモードをコメントアウトして、こちらのコメントアウトを外す -->
<div id="captureArea" class="capture-area-production">
  <div class="result-background capture-background">
    <img id="captureImage" src="" alt="合格証明書" class="result-bg-image capture-image">
    <div class="result-overlay">
      <div id="captureText" class="certificate-text"></div>
    </div>
  </div>
</div>

<!-- 外部JavaScriptファイル読み込み -->
<!-- 設定ファイル（GAS内のconfig.jsを埋め込み） -->
<script>
<?!= include('config'); ?>
</script>
<!-- メインスクリプト（GitHub Pages） -->
<script src="https://nomynoma.github.io/gas-kentei-quiz/script.js"></script>
</body>
</html>
