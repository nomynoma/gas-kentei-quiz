<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<base target="_top">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>クイズアプリ</title>
<link rel="icon" href="https://nomynoma.github.io/gas-kentei-quiz/imgs/favicon.svg" type="image/svg+xml">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<!-- 外部CSSファイル読み込み（GitHub Pages用） -->
<link rel="stylesheet" href="https://nomynoma.github.io/gas-kentei-quiz/style.css">
<!-- DOMPurify CDN を head に追加しておく -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
<!-- ヘッダーラッパー -->
<div class="header-wrapper">
  <!-- ヘッダーエリア -->
  <div class="header-area">
    <!-- 1行目：問題番号 -->
    <div class="header-row">
      <div class="header-left"></div>
      <div class="header-center">
        <!-- 問題番号表示エリア（問題画面でのみ表示） -->
        <div id="questionNumberHeader" class="question-number-header hidden"></div>
      </div>
      <div class="header-right"></div>
    </div>
    <!-- 2行目：TOPへ / 回答者 -->
    <div class="header-row">
      <div class="header-left">
        <button id="backToGenreButton" class="back-to-genre-btn hidden" onclick="backToGenreSelection()">
          ← ジャンル選択へ
        </button>
      </div>
      <div class="header-center"></div>
      <div class="header-right">
        <!-- ニックネーム表示エリア -->
        <div id="nicknameDisplay" class="nickname-display">
          <span id="nicknameText"></span>
          <button id="editNicknameBtn" class="edit-nickname-btn" onclick="editNickname()" title="編集">🖊️</button>
        </div>
      </div>
    </div>
  </div>
  <!-- 回答状況インジケーター（ヘッダー下にぶら下げ） -->
  <div id="progressIndicatorHeader" class="progress-indicator-header hidden"></div>
</div>

<div class="container">

  <!-- ニックネーム入力画面 -->
  <div id="nicknameScreen" class="screen active">
    <div id="nicknameForm">
      <h1>📝 ニックネーム入力</h1>
      <p class="description-text">
        合格証明書に表示するニックネームを入力してください
      </p>
      <!-- 編集モード時の警告メッセージ -->
      <div id="nicknameWarning" class="nickname-warning hidden">
        ⚠️ ニックネームを変更しても合格証の名前は自動で変更されません
      </div>
      <input type="text" id="nicknameInput" maxlength="10" placeholder="ニックネームを入力" class="text-input">
      <div id="nicknameError" class="error-text"></div>
      <button class="btn" onclick="submitNickname()">次へ</button>
    </div>
    <div id="preparingMessage" class="hidden">
      <h1>⏳ 問題作成中...</h1>
      <p class="description-text-top">
        しばらくお待ちください
      </p>
    </div>
  </div>

  <!-- ジャンル選択画面 -->
  <div id="genreScreen" class="screen">
    <h1>📚 ジャンル選択</h1>
    <p class="description-text">
      挑戦したいジャンルを選んでください
    </p>
    <!-- ジャンルボタンはconfig.jsのGENRE_NAMESから動的に生成 -->
    <div id="genreButtons"></div>
  </div>

  <!-- 問題画面 -->
  <div id="questionScreen" class="screen">
    <!-- 複数選択の注意書き -->
    <div id="multipleInstruction" class="multiple-instruction" style="display:none;">
      ⚠️ 複数選択問題です。該当する選択肢をすべて選んでください。
    </div>
    
    <!-- 問題文 -->
    <div id="questionText" class="question-text"></div>
    
    <!-- 選択肢 -->
    <div id="choices"></div>

    <!-- スライダー風ナビゲーションボタン（画面左右） -->
    <button id="prevQuestionBtn" class="slider-nav-btn slider-nav-left" onclick="previousQuestion()">
      <span class="slider-nav-icon">‹</span>
    </button>
    <button id="nextQuestionBtn" class="slider-nav-btn slider-nav-right" onclick="nextQuestion()">
      <span class="slider-nav-icon">›</span>
    </button>

    <!-- 採点ボタンエリア -->
    <div id="navigation"></div>
  </div>

  <!-- 不合格画面 -->
  <div id="failScreen" class="screen">
    <h1>😢 不合格</h1>
    <div class="score-text" id="failResultText"></div>
    <p class="description-text-vertical">10問全問正解で次のレベルへ進めます</p>
    <button class="btn btn-twitter" onclick="shareFailToX()">𝕏 で共有する</button>
    <button class="btn" onclick="retryLevel()">もう一度挑戦する</button>
  </div>

  <!-- 合格証明書画面 -->
  <div id="certificateScreen" class="screen">
    <!-- 合格証明書エリア（生成した画像を表示・クリックで別窓） -->
    <div id="certificateArea" class="certificate-area">
      <a id="certificateLink" href="" target="_blank">
        <img id="certificateDisplayImage" 
            src="" 
            alt="合格証明書" 
            class="certificate-display-image"
            title="クリックで別窓表示">
      </a>
    </div>
    <!-- ボタンエリア -->
    <div class="button-area">
      <button class="btn btn-green" onclick="downloadCertificate()">合格証をダウンロード</button>
      <button class="btn btn-twitter" onclick="shareToX()">𝕏 で共有する</button>
      <button class="btn" id="certificateNextBtn" onclick="nextSection()">次のレベルへすすむ</button>
      <button class="btn btn-gray" id="certificateBackBtn" onclick="backToGenreSelection()">ジャンル選択へ戻る</button>
    </div>
  </div>

  <!-- ローディング画面 -->
  <div id="loading" class="screen">
    <div class="loading">問題を読み込んでいます...</div>
  </div>

  <!-- 超級モード: 問題画面 -->
  <div id="ultraQuestionScreen" class="screen">
    <!-- タイマー表示 -->
    <div class="ultra-timer-area">
      <div class="ultra-timer" id="ultraTimer">10</div>
      <div class="ultra-progress-text">
        <span id="ultraCurrentNum">1</span> / <span id="ultraTotalNum">30</span>
      </div>
    </div>

    <h2 id="ultraQuestionText" class="question-text"></h2>
    <div id="ultraQuestionImage" class="question-image-container"></div>
    <div id="ultraChoices" class="choices"></div>
  </div>

  <!-- 超級モード: 失敗画面 -->
  <div id="ultraFailScreen" class="screen">
    <h1>💦 チャレンジ失敗</h1>
    <p class="ultra-fail-message">
      <span id="ultraFailNum"></span>問目でチャレンジ失敗しました
    </p>
    <div class="button-area">
      <button class="btn" onclick="backToGenreSelection()">ジャンル選択へ戻る</button>
      <button class="btn btn-primary" onclick="retryUltraMode()">もう一度挑戦</button>
    </div>
  </div>

</div>

<!-- ========================================
     キャプチャ用固定サイズ合格証エリア
     ========================================
     デバッグモード: 下記の1行目のコメントアウトを外すと画面に表示されます
     本番モード: 下記の2行目のコメントアウトを外すと画面外に配置されます
     ======================================== -->
<!-- デバッグモード: コメントアウトを外して有効化
<div id="captureArea" class="capture-area-debug">
  <div class="debug-label">DEBUG: キャプチャ元DOM (800x565)</div>
-->
<!-- 本番モード: デバッグモードをコメントアウトして、こちらのコメントアウトを外す -->
<div id="captureArea" class="capture-area-production">
  <div class="result-background capture-background">
    <img id="captureImage" src="" alt="合格証明書" class="result-bg-image capture-image">
    <div class="result-overlay">
      <div id="captureText" class="certificate-text"></div>
    </div>
  </div>
</div>

<!-- 外部JavaScriptファイル読み込み（GitHub Pages） -->
<script src="https://nomynoma.github.io/gas-kentei-quiz/config.js"></script>
<script src="https://nomynoma.github.io/gas-kentei-quiz/script.js"></script>
</body>
</html>
